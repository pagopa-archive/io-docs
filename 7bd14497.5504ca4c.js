(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{65:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return p}));var o=n(2),a=n(6),r=(n(0),n(78)),i={title:"Development styleguide"},s={unversionedId:"io-handbook/development-styleguide",id:"io-handbook/development-styleguide",isDocsHomePage:!1,title:"Development styleguide",description:"A practical reason to use a style guide is that it helps you write code.",source:"@site/docs/io-handbook/development-styleguide.md",slug:"/io-handbook/development-styleguide",permalink:"/io-docs/io-handbook/development-styleguide",editUrl:"https://github.com/pagopa/io-docs/edit/main/docs/io-handbook/development-styleguide.md",version:"current",sidebar:"docs",previous:{title:"Development guidelines",permalink:"/io-docs/io-handbook/development-guidelines"},next:{title:"Technology Radar",permalink:"/io-docs/io-handbook/technology-radar"}},c=[{value:"Typescript",id:"typescript",children:[]},{value:"FP-TS",id:"fp-ts",children:[]},{value:"ITALIA-TS-COMMONS",id:"italia-ts-commons",children:[]},{value:"REACT / REACT NATIVE",id:"react--react-native",children:[]},{value:"TESTING",id:"testing",children:[]}],l={rightToc:c};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"A practical reason to use a style guide is that it helps you write code.\nFurthermore, it shows commons mistakes or scenarios and how to handle them"),Object(r.b)("h3",{id:"typescript"},"Typescript"),Object(r.b)("h4",{id:"avoid-object-modification"},"Avoid object modification."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Due to its dynamic nature, JavaScript makes it\xa0extremely\xa0easy to modify objects that you do not own"),Object(r.b)("li",{parentName:"ul"},"Such practice should generally be avoided as it can lead to maintenance problems and can produce hard to find bugs"),Object(r.b)("li",{parentName:"ul"},"If you don't own it, don't modify it")),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),'let bob = { name: "Bob", surname: "Smith", age: 23 };\nbob.age = 24; // avoid\n// create a new object using spread operator to update only specific fields\nconst olderBob = { ...bob, age: 24 };\n')),Object(r.b)("h4",{id:"avoid-hiding-exceptions"},"Avoid hiding exceptions"),Object(r.b)("p",null,"Usually in Javascript and Typescript is hard to figure out whether a function throws an exception or not.\nTry not to use exceptions at all, you can use eithers instead in 99% of cases. Exceptions must be limited to the scope of the main() method in case you need to early exit the process with an error message.\nIf you need to throw an exception, try to be explicit at least."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),'//\n// \u2705good: no exception is thrown\n//\n\nconst config = (key: string): Option<string> => (\n  fromNullable(process.env[key])\n);\n\nconst callService () => {\n  sequenceS(option)({\n    token: config("token"),\n    url: config("url")\n  }).map(({ toke, url }) => {\n    // do stuff here ...\n  })\n};\n\n//\n// \u2705good: exception is thrown explicitly at least\n//\n\nconst config = (key: string): Option<string> => (\n  fromNullable(process.env[key])\n);\n\nconst callService () => {\n  const token: string = config("token").getOrElseL(() => {\n    throw new Error("Must provide a token!");\n  });\n  const url: string = config("url").getOrElseL(() => {\n    throw new Error("Must provide a url!");\n  });\n\n  // do stuff here ...\n};\n\n\n//\n// \u274cbad: exception is hidden inside the "config" function\n//\n\nconst config = (key: string): string => {\n  const value = process.env[key];\n  if(!value) throw new Error(`Must provide a value for key ${key}!`);\n  return value;\n};\n\nconst callService () => {\n  const token: string = config("token");\n  const url: string = config("url");\n\n  // do stuff here ...\n};\n\n')),Object(r.b)("h3",{id:"fp-ts"},Object(r.b)("a",Object(o.a)({parentName:"h3"},{href:"https://gcanti.github.io/fp-ts/modules/Option.ts.html"}),"FP-TS")),Object(r.b)("h4",{id:"use-options-to-handle-nullable-values"},"Use ",Object(r.b)("a",Object(o.a)({parentName:"h4"},{href:"https://github.com/gcanti/fp-ts/blob/1.12.0/src/Option.ts"}),"Options")," to handle nullable values."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"import { fromNullable, Option, some } from \"fp-ts/lib/Option\";\n\n// this is a common scenario where we want to model an user with email preferences\n\n// undefined -> user doesn't give any feedback\n// true -> users wants to receive email\n// false -> users doesn't want to receive email\ntype EmailPreference = boolean | undefined;\n\ntype User = {\n  id: number;\n  emailPreference: EmailPreference;\n};\n\nconst user: User = { id: 1, emailPreference: true };\n\n// check if user wants to receive email\nif (user.emailPreference !== undefined && user.emailPreference === true) {\n  // send email\n} else {\n  console.log(\"can't send email due to the user's preference\");\n}\n\n// use option\nfromNullable(user.emailPreference).map((pref) => {\n  if (pref) {\n    // send email\n  } else {\n    console.log(\"can't send email due to the user's preference\");\n  }\n});\n")),Object(r.b)("h4",{id:"use-either-to-handle-success-or-failure"},"Use ",Object(r.b)("a",Object(o.a)({parentName:"h4"},{href:"https://github.com/gcanti/fp-ts/blob/1.12.0/src/Either.ts"}),"Either")," to handle success or failure."),Object(r.b)("p",null,"For some scenario you should be interested why a computation failed\nUsing Option is usefull when you want know if a value is present or not.\nThe reason why it is not present it's not interesting\nIf you want to know more about computation failure you should use Either"),Object(r.b)("p",null,"Consider this example:\nwrite a function to validate a string\nit has to be greater than 8 chars"),Object(r.b)("h4",{id:"a-possible-implementation"},"a possible implementation"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),'// throw an error if the value is not compliant\nexport const validateString = (value: string): string => {\n  if (value.length < 8) {\n    throw new Error("the string it too short");\n  }\n  return value;\n};\n\nconst myString = "123456A";\n\ntry {\n  const validatedString = validateString(myString);\n  // do stuffs with the validated string\n} catch (err) {\n  //ops, something has gone wrong\n  console.error(err);\n}\n')),Object(r.b)("h4",{id:"using-either"},"using Either"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),'export const validateStringEither = (value: string): Either<Error, string> => {\n  if (value.length < 8) {\n    return left(Error("the string it too short"));\n  }\n  return right(value);\n};\n\nconst validatedStringEither = validateStringEither(myString);\n\nvalidatedStringEither.fold(\n  (err) => {\n    console.error(err);\n  },\n  (value) => {\n    // do stuffs with the validated string\n  }\n);\n')),Object(r.b)("p",null,"if your validation function could raise multiple errors\nyou should use ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://dev.to/gcanti/getting-started-with-fp-ts-either-vs-validation-5eja"}),"Validation")," to collect them."),Object(r.b)("h4",{id:"avoid-the-use-of-imperative-methods-like-isleft-and-isnone"},"Avoid the use of imperative methods like ",Object(r.b)("inlineCode",{parentName:"h4"},"isLeft")," and ",Object(r.b)("inlineCode",{parentName:"h4"},"isNone"),"."),Object(r.b)("p",null,"When possible avoid to use ",Object(r.b)("inlineCode",{parentName:"p"},"isNone")," / ",Object(r.b)("inlineCode",{parentName:"p"},"isLeft")," checks that makes code verbose (and more imperative). Use functional construct from ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://gcanti.github.io/fp-ts/modules/Option.ts.html"}),Object(r.b)("inlineCode",{parentName:"a"},"fp-ts"))," types instead (fold, map, mapLeft, bimap, getOrElse, ...)."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"//\n// \u2705good: use of fp-ts's algebric constructs\n//\n\n// with Option\nconst name: string = fromNullable(user.name).getOrElseL(() => {\n  // handle none here\n});\n\n// with Either\nconst validString: string = validatedStringEither.fold(\n  (err) => {\n    // handle left here\n  },\n  (value) => value\n);\n\n//\n// \u274cbad: imperative code\n//\n\n// with Option\nconst nameOption = fromNullable(user.name);\nif (isNone(nameOption)) {\n  // handle none here\n}\n\n// with Either\nif (isLeft(validatedStringEither)) {\n  // handle left here\n}\n")),Object(r.b)("h3",{id:"italia-ts-commons"},Object(r.b)("a",Object(o.a)({parentName:"h3"},{href:"https://github.com/pagopa/io-ts-commons"}),"ITALIA-TS-COMMONS")),Object(r.b)("h4",{id:"use-pot-to-handle-the-states-of-remote-potential-data"},"Use ",Object(r.b)("a",Object(o.a)({parentName:"h4"},{href:"https://github.com/pagopa/io-ts-commons/blob/master/src/pot.ts"}),"Pot")," to handle the states of remote (potential) data."),Object(r.b)("p",null,"Usually an application could deal with loading some data, from remote or local sources.\nPot (for potential) is a data type that helps you to keep track of states, value and errors.\nThis example shows a reducer that handles the loading of a remote user"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"type User = {\n  name: string;\n  username: string;\n};\n\ntype UserState = {\n  currentUser: pot.Pot<User, Error>;\n};\n\nfunction userReducer(\n  state: UserState = { currentUser: pot.none },\n  action: Action\n): UserState {\n  switch (action.type) {\n    case getType(contentServiceLoad.request):\n      return {\n        ...state,\n        // a loading is requested, set the pot in loading with none value\n        currentUser: pot.noneLoading,\n      };\n    case getType(contentServiceLoad.success):\n      return {\n        ...state,\n        // the loading is completed, set the pot to some with the retrieved value\n        currentUser: pot.some(action.payload),\n      };\n\n    case getType(contentServiceLoad.failure):\n      return {\n        ...state,\n        // some errors occured, set the pot to error by setting the error (action.payload)\n        // and keep the current state value (eventually we can access the previous value)\n        currentUser: pot.toError(state.currentUser, action.payload),\n      };\n  }\n}\n")),Object(r.b)("h3",{id:"react--react-native"},"REACT / REACT NATIVE"),Object(r.b)("h4",{id:"avoid-potentially-inconsistent-state-update-react"},"Avoid potentially inconsistent state update (React)"),Object(r.b)("p",null,Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://medium.com/react-ecosystem/how-to-handle-state-in-react-6f2d3cd73a0c"}),"How to handle state in React. The missing FAQ.")),Object(r.b)("p",null,"Updating the state of a component based on the current value of ",Object(r.b)("em",{parentName:"p"},"this.state")," or ",Object(r.b)("em",{parentName:"p"},"this.props")," may lead to inconsistent component state."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),"// this is a potentially inconsistent state update\nthis.setState({ amount: this.state.amount + 1 });\n\n// simple solution\n// - get data from state\n// - update data\n// - set state with the updated data\nconst amount = this.state.amount + 1;\nthis.setState({ amount });\n\n// react solution\n// pass an updater to setState\nthis.setState((prevState: State, _: Props) => {\n  return { amount: prevState.amount + 1 };\n});\n")),Object(r.b)("h3",{id:"testing"},"TESTING"),Object(r.b)("h4",{id:"test-files-must-be-close-to-the-component-that-test"},"Test files must be close to the component that test"),Object(r.b)("p",null,"Place test files in a ",Object(r.b)("inlineCode",{parentName:"p"},"__tests__")," folder at the same level of the file containing the module you want to test. When possible, call test files with the same name of the module file but with ",Object(r.b)("inlineCode",{parentName:"p"},".test.ts")," extension.\nTo test ",Object(r.b)("inlineCode",{parentName:"p"},"foobar.ts"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{}),"/src\n|_ /__tests__\n|  |_ foobar.test.ts\n|_ foobar.ts\n")),Object(r.b)("h4",{id:"test-titles-must-be-in-the-form-it-should-"},"Test titles must be in the form ",Object(r.b)("em",{parentName:"h4"},'"it should ..."')),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),'// \u2705good\nit("should have `name` property", () => { ... });\n\n// \u274cbad: test title must be in "should" form\nit("has `name` property", () => { ... });\n\n// \u274cbad: use "it" instead of "test"\ntest("should have `name` property", () => { ... });\n')),Object(r.b)("h4",{id:"avoid-throwing-exceptions"},"Avoid throwing exceptions"),Object(r.b)("p",null,"Sometimes test code can have unhappy branches you don't want to test and hence consider as a test failure. Try not to throw exceptions in there.\nIf you are using ",Object(r.b)("inlineCode",{parentName:"p"},"Jest"),", you can use ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://jest-bot.github.io/jest/docs/expect.html#expectassertionsnumber"}),Object(r.b)("inlineCode",{parentName:"a"},"expect.assertions")),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),'// \u2705good\nexpect.assertions(1);\nmyDecoder.fold(\n  () => {},\n  (value) => {\n    expect(value).toEqual( ... );\n  }\n);\n\n// \u274cbad\nmyDecoder.fold(\n  () => {\n    throw new Error("test should not pass here");\n  },\n  (value) => {\n    expect(value).toEqual( ... );\n  }\n);\n\n')),Object(r.b)("h4",{id:"avoid-wrapping-tests-with-helper-functions"},"Avoid wrapping tests with helper functions"),Object(r.b)("p",null,"Be explicit in the test you are executing. If you are repeating te same test in many places, don't be tempted to wrap common tests into helpers. We encourage code duplication in favor of more explicit logic."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-typescript"}),'//\n// \u2705good: each suite has its own test explicitly declared\n//\n\n// sum.test.ts\ndescribe("Sum", () => {\n  it("should be 6", () => {\n    expect(2 + 4).toBe(6);\n  });\n});\n\n// prod.test.ts\ndescribe("Prod", () => {\n  it("should be 8", () => {\n    expect(2 * 4).toBe(8);\n  });\n});\n\n\n//\n// \u274cbad: "it" calls are hidden inside an helper function\n//\n\n// helpers.ts\nexport const testValue = (title, value, expected) => (\n  it(title, () => {\n    expect(value).toBe( ... );\n  });\n)\n\n// sum.test.ts\nimport { testValue } from "./helpers.ts";\n\ndescribe("Sum", () => {\n  testValue("should be 6", 2 + 4, 6);\n});\n\n// prod.test.ts\nimport { testValue } from "./helpers.ts";\n\ndescribe("Prod", () => {+\n  testValue("should be 8", 2 * 4, 8);\n});\n')))}p.isMDXComponent=!0},78:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var o=n(0),a=n.n(o);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),p=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),b=o,h=u["".concat(i,".").concat(b)]||u[b]||d[b]||r;return n?a.a.createElement(h,s(s({ref:t},l),{},{components:n})):a.a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=b;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);